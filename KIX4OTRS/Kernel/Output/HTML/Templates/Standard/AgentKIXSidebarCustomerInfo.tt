# --
# AgentKIXSidebarCustomerInfo.tt - provides HTML to show CustomerInfo in KIXSidebar
# Copyright (C) 2006-2016 c.a.p.e. IT GmbH, http://www.cape-it.de
#
# written/edited by:
# * Rene(dot)Boehm(at)cape(dash)it(dot)de
# * Dorothea(dot)Doerffel(at)cape(dash)it(dot)de
# --
# $Id$
# --
# This software comes with ABSOLUTELY NO WARRANTY. For details, see
# the enclosed file COPYING for license information (AGPL). If you
# did not receive this file, see http://www.gnu.org/licenses/agpl.txt.
# --

<div id="CustomerInfo" class="WidgetSimple CanDrag">
    <div class="Header">
        <div class="WidgetAction Toggle">
            <a title="[% Translate("Show or hide the content") | html %]" href="#" id="KIXSidebarCustomerInfoBlockOpen" aria-controls="Core_UI_AutogeneratedID_0" aria-expanded="false">
                <i class="fa fa-caret-right"></i>
                <i class="fa fa-caret-down"></i>
            </a>
        </div>
        <h2>[% Translate(Data.Title) | html %]</h2>
    </div>
[% RenderBlockStart("CustomerEmailSelection") %]
    <div class="KIXSidebarCustomerEmailSelection">
        [% Data.CustomerEmailSelection %]
    </div>
[% RenderBlockEnd("CustomerEmailSelection") %]
    <div class="Content">
        <span class="CustomerDetailsMagnifier">
[% RenderBlockStart("CustomerDetailsMagnifier") %]
            <i class="fa fa-search"></i>
[% RenderBlockEnd("CustomerDetailsMagnifier") %]
        </span>
        [% Data.CustomerTable %]
    </div>
    <div class="WidgetPopup" id="CustomerDetails[% Data.UserLogin | html %]">
        <div class="Header"><h2>[% Translate("Contact Information") | html %]</h2></div>
        <div class="Content">
            <div class="Spacing">
[% RenderBlockStart("CustomerDetails") %]
                [% Data.CustomerDetailsTable %]
[% RenderBlockEnd("CustomerDetails") %]
            </div>
        </div>
    </div>
</div>
[% WRAPPER JSOnDocumentComplete %]
<script type="text/javascript">//<![CDATA[
if ( '[% Env("Action") %]' == 'AgentTicketZoom' ) {

    Core.KIX4OTRS.KIXSidebarCustomerInfo.UpdateContactSelection(Core.Config.Get('CGIHandle') + '?[% Config("SessionName") | uri %]=' + Core.App.GetSessionInformation().[% Config("SessionName") | uri %]+';','[% Data.TicketID %]','[% Data.ArticleID %]','');

    $(document).on('change','#CustomerUserEmail',function(){
        // open widget if it's closed
        if ($('#KIXSidebarCustomerInfoBlockOpen').attr('aria-expanded') == 'false')
            $('#KIXSidebarCustomerInfoBlockOpen').click();

        var CustomerID = $(this).val();
        Core.Agent.CustomerSearch.ReloadCustomerInfo(CustomerID,'AgentKIXSidebarCustomerInfo');
        Core.KIX4OTRS.KIXSidebarCustomerInfo.UpdateContactSelection(Core.Config.Get('CGIHandle') + '?[% Config("SessionName") | uri %]=' + Core.App.GetSessionInformation().[% Config("SessionName") | uri %]+';','[% Data.TicketID %]','[% Data.ArticleID %]',CustomerID);
    });
}
//]]>
</script>
[% END %]